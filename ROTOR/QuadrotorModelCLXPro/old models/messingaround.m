%%%

syms x1 x2 x3 x4 x5 x6 x7 x8 x9 x10 x11 x12
syms x1d x2d x3d x4d x5d x6d x7d x8d x9d x10d x11d x12d
syms o1 o2 o3 o4 b m iyy ixx izz Jr L
U1 = b*(o1^2 + o2^2 + o3^3 + o4^2);
U2 = b*(o2^2 - o4^2);
U3 = b*(o3^2 - o1^2);
U4 = d*(-o1^2 + o2^2 - o3^3 + o4^2);
O = -o1 + o2 - o3 + o4;


x1d = x2;
x2d = (cos(x7)*sin(x9)*cos(x11) + sin(x7)*sin(x11))*(U1/m);
x3d = x4;
x4d = (cos(x7)*sin(x9)*sin(x11) - sin(x7)*cos(x11))*(U1/m);
x5d = x6;
x6d = -g + (cos(x7)*cos(x9))*(U1/m);
x7d = x8;
x8d = ((iyy - izz)/ixx)*x10*x12 - (Jr/ixx)*x10*O + (L/ixx)*U2;
x9d = x10;
x10d = ((izz - ixx)/iyy)*x8*x12 + (Jr/ixx)*x8*O + (L/ixx)*U3;
x11d = x12;
x12d = U4/izz;



A = [0 1 0 0 0 0 0 0 0 0 0 0;
0 0 0 0 0 0 0 0 9.8089 0 0 0;
0 0 0 1 0 0 0 0 0 0 0 0;
0 0 0 0 0 0 -9.8089 0 0 0 0 0;
0 0 0 0 0 1 0 0 0 0 0 0;
0 0 0 0 0 0 0 0 0 0 0 0;
0 0 0 0 0 0 0 1 0 0 0 0;
0 0 0 0 0 0 0 0 0 0 0 0;
0 0 0 0 0 0 0 0 0 1 0 0;
0 0 0 0 0 0 0 0 0 0 0 0;
0 0 0 0 0 0 0 0 0 0 0 1;
0 0 0 0 0 0 0 0 0 0 0 0];


B =[0 0 0 0;
0 0 0 0;
0 0 0 0;
0 0 0 0;
0 0 0 0;
0.001119 0.001119 0.001119 0.001119;
0 0 0 0;
0 0.008234 0 -0.008234;
0 0 0 0;
-0.008234 0 0.008234 0;
0 0 0 0;
-0.005615 0.005615 -0.005615 0.005615];

C = eye(12);
[K,S,e] = lqr(A,B,200*eye(12),0.1*eye(4))







